<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Xclip With Kakoune Making It Work &middot; Blog atrasado
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A reserved <a href="http://jekyllrb.com" target="_blank">Jekyll</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item " href="/post">Posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently on </span>
  </nav>

  <div class="sidebar-item">
    <p>&copy; 2019. All rights reserved.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Blog atrasado</a>
            <small>con gajes del oficio</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">Xclip With Kakoune Making It Work</h1>
  <span class="post-date">Mar 25, 2019</span>
  <p>One of the pressing issues with Kakoune is the implementation
of <code>xclip</code> to use the clipboard selections.</p>
<p>As the <a href="https://github.com/mawww/kakoune/wiki/Registers---Clipboard/" target="_blank">Kakoune Registers &ndash; Clipboard Wiki</a> states it:</p>
<blockquote>
<p>Notice that <a href="https://github.com/mawww/kakoune/issues/2325" target="_blank">xclip will not work using this example</a></p>
</blockquote>
<p>This was one of the reasons why I wanted to delve further into this issue.</p>
<p>Anyhow, I'll copy-paste the various sections from the <a href="https://github.com/mawww/kakoune/wiki/Registers---Clipboard/" target="_blank">Kakoune Registers - Clipboard Wiki</a> that show a better overview of the steps to follow by adding the snippets into the initialization file, while using <code>xsel</code>. Then I will tweak around with the <code>xclip</code> features by using the three clipboards that <code>xclip</code> uses, namely, <code>p</code> (primary), <code>sec</code> (secondary), and finally <code>clip</code> for the clipboard.</p>
<p>Those are the options available by the use of <code>xclip</code>.</p>
<h3 id="using-the-system-clipboard">Using the System Clipboard</h3>
<p>You can use kakoune with <a href="https://wiki.archlinux.org/index.php/Clipboard">system clipboard tools</a> like <code>xsel</code>, <code>xclip</code> or <code>pbcopy`/</code>pbpaste`</p>
<h3 id="to-yank-copy">To yank (copy)</h3>
<p><code>&lt;a-|&gt; xsel --input --clipboard &lt;ret&gt;</code></p>
<p><code>&lt;a-|&gt;</code> pipes each selection through the given external filter program and ignore its output.</p>
<p>You may want to use the following hook to automate the dialog with the system clipboard, on each <code>y</code>, <code>d</code> or <code>c</code> operations:</p>
<pre><code>      hook global NormalKey y|d|c %{ nop %sh{
              printf %s &quot;$kak_main_reg_dquote&quot; | xsel --input --clipboard
      }}

### To paste

`! xsel --output --clipboard &lt;ret&gt;`

`!` inserts program output before selection while `&lt;a-!&gt;` inserts program output after selection.

Therefore you can add the following mappings:

### Paste before
`map global user P '!xsel --output --clipboard&lt;ret&gt;'`

### Paste after
`map global user p '&lt;a-!&gt;xsel --output --clipboard&lt;ret&gt;'`

### How to use it now
* y/d - yank/delete using internal clipboard AND system clipboard at once
* p   - paste from internal clipboard
* &lt;,p&gt; - paste after from system clipboard (, is default for user mode)
* &lt;,P&gt; - paste before from system clipboard (, is default for user mode)

## How to make it work with Xclip instead.

As I've found out, and as the issue clearly showed, this is not
currently possible by using Xclip under Kakoune, except of course by mapping
a key to Normal mode and then calling out `xclip`.

As the [freedesktop.org](https://specifications.freedesktop.org/clipboards-spec/clipboards-latest.txt)  website states it, this is not a task
that can be easily done as long as different clients have different methods that make use of these `clipboard` features. 

quoting from the [clipboards specifications freedesktop](https://specifications.freedesktop.org/clipboards-spec/clipboards-latest.txt)

&gt;There are two historical interpretations of the ICCCM:

&gt; a) use PRIMARY for mouse selection, middle mouse button paste, and
&gt;    explicit cut/copy/paste menu items (Qt 2, GNU Emacs 20)
&gt;
&gt; b) use CLIPBOARD for the Windows-style cut/copy/paste menu items;
&gt;    use PRIMARY for the currently-selected text, even if it isn't
&gt;    explicitly copied, and for middle-mouse-click (Netscape, Mozilla,
&gt;    XEmacs, some GTK+ apps)

&gt;No one ever does anything interesting with SECONDARY as far as I can
&gt;tell.

&gt;The current consensus is that interpretation b) is correct. Qt 3 and
&gt;GNU Emacs 21 will use interpretation b), changing the behavior of
&gt;previous versions.

And it follows with:

&gt;In addition, the ICCCM has a thing called &quot;cut buffers&quot; which most
&gt;clients no longer support.
&gt;
&gt;There are two historical interpretations of the ICCCM:
&gt;
&gt; a) use PRIMARY for mouse selection, middle mouse button paste, and
&gt;    explicit cut/copy/paste menu items (Qt 2, GNU Emacs 20)
&gt;
&gt; b) use CLIPBOARD for the Windows-style cut/copy/paste menu items;
&gt;    use PRIMARY for the currently-selected text, even if it isn't
&gt;    explicitly copied, and for middle-mouse-click (Netscape, Mozilla,
&gt;    XEmacs, some GTK+ apps)

And it summarizes it among many points with the following:


&gt;The correct behavior can be summarized as follows: CLIPBOARD works
&gt;just like the clipboard on Mac or Windows; it only changes on explicit
&gt;cut/copy. PRIMARY is an &quot;easter egg&quot; for expert users, regular users
&gt;can just ignore it; it's normally pastable only via
&gt;middle-mouse-click.

So the best course of action, since `xclip` is known to be
working fine under [vim](https://vim.org) or
[neovim](https://neovim.org), would be to map say in this
case, the `Y` key for yanking out operations, and the `P` key
for pasting the selection.

Of course, if other operations such as `delete` or `change`
as Kakoune currently employs, need to be mapped, I believe
that the keys can be assigned their own combinations.

We normally use the `clipboard` rather than the `primary` or
`secondary` X selections:

## To yank with Xclip

     map global normal &lt;Y&gt; ' $ xclip -select clip '

## To paste with Xclip

And to paste

     map global normal P '&lt;!&gt; xclip -select clip -o'


## Freeing register `&quot;` on Kakoune and yanking with p

The above mapping of both the `Y` or `P` key registers,
do not restrain the operations by which `y` that records the
operation to register `&quot;`  or `p` that pastes it.

There's no possible way to do it with the otherwise rest of
the `clipboards` options that `xclip` uses, without further
noticing that the register `y` that is used for normal
yanking operations under Kakoune, wouldn't work as expected.
And neither by pastting that same register `&quot;`.

...

**Other references**

&lt;a href=&quot;https://unix.stackexchange.com/questions/22494/copy-file-to-xclip-and-paste-to-firefox&quot; target=&quot;_blanK&quot;&gt;unix stackexchange -- copy file to xclip and paste on firefox&lt;/a&gt;
</code></pre>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>

